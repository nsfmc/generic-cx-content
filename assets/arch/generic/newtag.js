/* * newtag.js 2006.march.22, Marcos.a.Ojeda *  * This file provides a series of functions that append 'new' to any html * element that has been followed by a comment like <!--date.yyyy.mm.dd--> * where yyyy is a four year date format, like 2006, mm is a month, like 03 * for march and dd is a date like 24 or 02. *//* *   dateDiff takes two javascript dates objects and returns the number of * days between them by converting between milliseconds to days */function dateDiff(/* Date */d1, /* Date */d2){  var diff = (d1 - d2) / 60 / 60 / 24 / 1000;  //alert(diff)  return Math.floor(diff)}/* *   addNew appends a strong 'New:' to the previous sibling of 'node' * for this reason, date tagged comments should always follow elements that * should be tagged as 'new'. */function addNew(/* node */node, /* number */delta){  var ps = node.previousSibling  var fc = ps.firstChild  if(ps != null){    var text = document.createTextNode("New! ")    var strong = document.createElement("sup")    strong.setAttribute("title","Posted "+ delta + " days ago");    strong.appendChild(text)    ps.insertBefore(strong,fc)  }}/* *   dateFilter takes a node from createTreeWalker and then returns  * FILTER_ACCEPT if the node is a date tagged comment. */var dateFilter = function(n){  if(n.nodeType == 8){    var comment = n.nodeValue.split(".")    if(comment[0] == "date")      return NodeFilter.FILTER_ACCEPT  }  else return NodeFilter.FILTER_REJECT}/* *   This part right here actually finds the date tagged comment and then * acts on it if the difference in dates is less than var cutoff (if set) * otherwise, cutoff is set to be 30 days. */ if(!newtag_timeout){  var newtag_timeout = 30}function newTag(){   var kids = document.createTreeWalker(document.body, NodeFilter.SHOW_COMMENT, dateFilter, false)  var brat = kids.firstChild();  if(brat){    do{      var ar = brat.nodeValue.split(".")      ar.shift()      var today = new Date()      var tagDate = new Date()      tagDate.setFullYear(ar[0],ar[1]-1,ar[2])      var delta = dateDiff(today,tagDate)      if(delta < newtag_timeout)        addNew(brat,delta)      brat = kids.nextSibling()    }    while(brat !=null)  }}pushOnload(newTag)